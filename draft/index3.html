// ========= 3) Lights =========
const ambient = new THREE.AmbientLight(0xffffff, 0.4);
const point = new THREE.PointLight(0xffffff, 1.0, 100);
point.position.set(0, 2.4, 0); // lampu dekat atap, pusat ruangan
scene.add(ambient, point);

// ========= 4) Texture loader + fallback =========
const loader = new THREE.TextureLoader();

function makeFallback(label) {
  const c = document.createElement("canvas");
  c.width = c.height = 256;
  const ctx = c.getContext("2d");
  ctx.fillStyle = "#2a2a2a";
  ctx.fillRect(0, 0, 256, 256);
  ctx.fillStyle = "#999";
  ctx.font = "16px system-ui";
  ctx.fillText(label, 20, 130);
  return new THREE.CanvasTexture(c);
}

function safeLoad(path, label) {

  let tex = loader.load(
    path,
    () => {
      tex.needsUpdate = true;
    },
    undefined,
    () => {
      tex = makeFallback(label);
    }
  );
  tex.wrapS = tex.wrapT = THREE.RepeatWrapping;
  tex.minFilter = THREE.LinearMipmapLinearFilter;
  tex.magFilter = THREE.LinearFilter;
  tex.anisotropy = renderer.capabilities.getMaxAnisotropy();
  return tex;
}

// Ganti dengan file Anda (opsional); jika tidak ada, fallback akan tampil;
const floorTex = safeLoad("floor.jpg", "floor.jpg?");
const wallTex = safeLoad("wall.jpg", "wall.jpg?");
const ceilingTex = safeLoad("ceiling.jpg", "ceiling.jpg?");

// Tiling bawaan
floorTex.repeat.set(2, 2);
wallTex.repeat.set(1.5, 1);
ceilingTex.repeat.set(1, 1);

// ========= 5) Materials – FrontSide (menghadap interior) =========
const matFloor = new THREE.MeshStandardMaterial({
  map: floorTex,
  side: THREE.FrontSide,
});
const matWall = new THREE.MeshStandardMaterial({
  map: wallTex,
  side: THREE.FrontSide,
});
const matCeiling = new THREE.MeshStandardMaterial({
  map: ceilingTex,
  side: THREE.FrontSide,
});

// ========= 6) Room Geometry (dilihat dari dalam) =========
// Ukuran ruangan
const W = 4; // lebar  X
const H = 3; // tinggi Y
const D = 6; // panjang Z

// LANTAI: normal +Y (rotasi -90° X)
const floor = new THREE.Mesh(new THREE.PlaneGeometry(W, D), matFloor);
floor.rotation.x = -Math.PI / 2;
floor.position.set(0, 0, 0);
scene.add(floor);

// ATAP: normal -Y (rotasi +90° X)
const ceiling = new THREE.Mesh(new THREE.PlaneGeometry(W, D), matCeiling);
ceiling.rotation.x = Math.PI / 2;

ceiling.position.set(0, H, 0);
scene.add(ceiling);

// DINDING BELAKANG (z = -D/2): sisi interior menghadap +Z → TANPA rotasi;
const backWall = new THREE.Mesh(new THREE.PlaneGeometry(W, H), matWall);
backWall.position.set(0, H / 2, -D / 2);
scene.add(backWall);

// DINDING DEPAN (z = +D/2): sisi interior menghadap -Z → rotasi 180° Y;
const frontWall = new THREE.Mesh(new THREE.PlaneGeometry(W, H), matWall);
frontWall.rotation.y = Math.PI;
frontWall.position.set(0, H / 2, D / 2);
scene.add(frontWall);

// DINDING KIRI  (x = -W/2): sisi interior menghadap +X → rotasi -90° Y;
const leftWall = new THREE.Mesh(new THREE.PlaneGeometry(D, H), matWall);
leftWall.rotation.y = -Math.PI / 2;
leftWall.position.set(-W / 2, H / 2, 0);
scene.add(leftWall);

// DINDING KANAN (x = +W/2): sisi interior menghadap -X → rotasi +90° Y;
const rightWall = new THREE.Mesh(new THREE.PlaneGeometry(D, H), matWall);
rightWall.rotation.y = Math.PI / 2;
rightWall.position.set(W / 2, H / 2, 0);
scene.add(rightWall);
